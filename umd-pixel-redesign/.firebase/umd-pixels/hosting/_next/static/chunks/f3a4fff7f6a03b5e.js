(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return l}});let l=e=>{}},84774,e=>{"use strict";var t=e.i(43476),a=e.i(75157);function l({className:e,...l}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...l})})}function s({className:e,...l}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...l})}function r({className:e,...l}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...l})}function d({className:e,...l}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...l})}function i({className:e,...l}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...l})}function n({className:e,...l}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...l})}e.s(["Table",()=>l,"TableBody",()=>r,"TableCell",()=>n,"TableHead",()=>i,"TableHeader",()=>s,"TableRow",()=>d])},52683,e=>{"use strict";var t=e.i(43476),a=e.i(45678),l=e.i(11870),s=e.i(84774);function r({rows:e,enabled:a}){return(0,t.jsxs)("section",{className:"rounded-2xl border border-border bg-card p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Leaderboard"}),!a&&(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Hidden"})]}),a?(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(s.Table,{children:[(0,t.jsx)(s.TableHeader,{children:(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableHead,{children:"#"}),(0,t.jsx)(s.TableHead,{children:"Name"}),(0,t.jsx)(s.TableHead,{className:"text-right",children:"Pixels"})]})}),(0,t.jsxs)(s.TableBody,{children:[e.map((e,a)=>(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{className:"text-muted-foreground",children:a+1}),(0,t.jsx)(s.TableCell,{className:"text-foreground",children:e.name}),(0,t.jsx)(s.TableCell,{className:"text-right font-semibold text-foreground",children:e.pixels})]},e.id)),0===e.length&&(0,t.jsx)(s.TableRow,{children:(0,t.jsx)(s.TableCell,{colSpan:3,className:"py-6 text-center text-muted-foreground",children:"No leaderboard data yet."})})]})]})}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Leaderboard is disabled for this semester."})]})}var d=e.i(71645),i=e.i(19455);function n({rows:e}){let[a,l]=(0,d.useState)(0),[r,n]=(0,d.useState)("date"),[o,c]=(0,d.useState)("desc"),x=(0,d.useMemo)(()=>{let t=[...e];return t.sort((e,t)=>{let a="asc"===o?1:-1;return"pixels"===r?a*((e.pixelsAllocated||0)-(t.pixelsAllocated||0)):"name"===r?a*e.name.localeCompare(t.name):a*(new Date(e.date).getTime()-new Date(t.date).getTime())}),t},[e,o,r]),m=Math.max(1,Math.ceil(x.length/10)),u=(0,d.useMemo)(()=>{let e=10*a;return x.slice(e,e+10)},[a,x]),h=a>0,b=a<m-1,j=e=>{r===e?c(e=>"asc"===e?"desc":"asc"):(n(e),c("desc")),l(0)};return(0,t.jsxs)("section",{className:"rounded-2xl border border-border bg-card p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Pixel log"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.length," events"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>l(e=>Math.max(0,e-1)),disabled:!h,children:"Prev"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["Page ",a+1," of ",m]}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>l(e=>Math.min(m-1,e+1)),disabled:!b,children:"Next"})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(s.Table,{children:[(0,t.jsx)(s.TableHeader,{children:(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableHead,{children:"Date"}),(0,t.jsx)(s.TableHead,{children:(0,t.jsxs)("button",{onClick:()=>j("name"),className:"flex items-center gap-1",children:["Name ","name"===r?"asc"===o?"▲":"▼":""]})}),(0,t.jsx)(s.TableHead,{children:"Type"}),(0,t.jsx)(s.TableHead,{children:"Attendance"}),(0,t.jsx)(s.TableHead,{className:"text-right",children:(0,t.jsxs)("button",{onClick:()=>j("pixels"),className:"flex w-full items-center justify-end gap-1",children:["Pixels Allocated ","pixels"===r?"asc"===o?"▲":"▼":""]})}),(0,t.jsx)(s.TableHead,{className:"text-right",children:"Pixels Earned"})]})}),(0,t.jsxs)(s.TableBody,{children:[u.map(e=>(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{className:"whitespace-nowrap text-foreground",children:e.date}),(0,t.jsx)(s.TableCell,{className:"text-foreground",children:e.name}),(0,t.jsx)(s.TableCell,{className:"text-muted-foreground",children:e.type}),(0,t.jsx)(s.TableCell,{className:"text-muted-foreground",children:e.attendance}),(0,t.jsx)(s.TableCell,{className:"text-right text-muted-foreground",children:e.pixelsAllocated}),(0,t.jsx)(s.TableCell,{className:"text-right font-semibold text-foreground",children:e.pixelsEarned})]},e.id)),0===e.length&&(0,t.jsx)(s.TableRow,{children:(0,t.jsx)(s.TableCell,{colSpan:6,className:"py-6 text-center text-muted-foreground",children:"No events yet."})})]})]})})]})}function o({name:e,email:a,pixelTotal:l,pixelDelta:s,rank:r}){return(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-[2fr,1fr]",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-border bg-card p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"text-sm uppercase tracking-wide text-muted-foreground",children:"Welcome"}),(0,t.jsx)("div",{className:"text-2xl font-semibold text-foreground",children:e}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:a})]}),(0,t.jsxs)("div",{className:"mt-6 flex items-baseline gap-3",children:[(0,t.jsx)("div",{className:"text-4xl font-bold text-foreground",children:l}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"pixels"})]}),r&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-muted-foreground",children:["Rank: #",r]})]}),0!==s&&(0,t.jsxs)("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-4 text-sm text-amber-900 shadow-sm",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Manual adjustment applied"}),(0,t.jsxs)("p",{className:"mt-1 leading-relaxed",children:[s>0?"+":"",s," pixels added by an admin."]})]})]})}function c({pixelDelta:e}){return e?(0,t.jsxs)("section",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900 shadow-sm",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Manual adjustment applied"}),(0,t.jsxs)("p",{className:"mt-1 leading-relaxed",children:["Your pixel total includes a manual adjustment of ",e>0?"+":"",e,". Reach out to an admin if you have questions."]})]}):null}var x=e.i(15288);function m({rows:e}){return e.length?(0,t.jsxs)(x.Card,{children:[(0,t.jsxs)(x.CardHeader,{children:[(0,t.jsx)(x.CardTitle,{children:"Activities"}),(0,t.jsx)(x.CardDescription,{children:"Pixels from coffee chats, bonding, and other activities."})]}),(0,t.jsx)(x.CardContent,{children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(s.Table,{children:[(0,t.jsx)(s.TableHeader,{children:(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableHead,{children:"Name"}),(0,t.jsx)(s.TableHead,{children:"Type"}),(0,t.jsx)(s.TableHead,{className:"text-right",children:"Pixels per"}),(0,t.jsx)(s.TableHead,{className:"text-right",children:"Multiplier"}),(0,t.jsx)(s.TableHead,{className:"text-right",children:"Total"})]})}),(0,t.jsx)(s.TableBody,{children:e.map(e=>(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{className:"text-foreground",children:e.name}),(0,t.jsx)(s.TableCell,{className:"text-muted-foreground",children:e.type}),(0,t.jsx)(s.TableCell,{className:"text-right text-muted-foreground",children:e.pixelsPer}),(0,t.jsx)(s.TableCell,{className:"text-right text-muted-foreground",children:e.multiplier}),(0,t.jsx)(s.TableCell,{className:"text-right font-semibold text-foreground",children:e.total})]},e.id))})]})})})]}):null}var u=e.i(32341);e.i(36180);var h=e.i(98925),b=e.i(59141);let j=["GBM","other_mandatory"];async function p(e){let t=await (0,h.getDoc)((0,h.doc)(b.db,"users",e));if(!t.exists())throw Error("User document not found");let a=t.data()||{},l=a.pixelDelta??a.pixeldelta??0,s=await (0,h.getDoc)((0,h.doc)(b.db,"settings","global")),r=s.data()?.currentSemesterId,d=!!s.data()?.isLeadershipOn,i=await (0,h.getDocs)((0,h.query)((0,h.collectionGroup)(b.db,"excused_absences"),(0,h.where)("userId","==",e),(0,h.where)("status","==","approved"))),n=new Set;i.forEach(e=>{let t=e.ref.parent.parent;t&&n.add(t.id)});let o=r?(0,h.query)((0,h.collection)(b.db,"events"),(0,h.where)("semesterId","==",r),(0,h.orderBy)("date","desc")):(0,h.query)((0,h.collection)(b.db,"events"),(0,h.orderBy)("date","desc")),c=await (0,h.getDocs)(o),x=[],m=0;c.forEach(t=>{var a;let l=t.data(),s=l.attendees||[],r=l.pixels||0,d=(a=l.date,a?.toDate?a.toDate():a instanceof Date?a:"string"==typeof a||"number"==typeof a?new Date(a):new Date),i="No Show";s.includes(e)&&(i="Attended"),n.has(t.id)&&(i="Excused"),j.includes(l.type)&&"No Show"===i&&(i="Unexcused");let o="Attended"===i&&r>0?r:0;o>0&&(m+=o),x.push({id:`${t.id}-${e}`,eventId:t.id,date:d.toLocaleDateString(),name:l.name||"Event",type:l.type||"event",attendance:i,pixelsAllocated:r,pixelsEarned:o})});let u=[];(await (0,h.getDocs)((0,h.query)((0,h.collection)(b.db,"activities"),(0,h.where)("semesterId","==",r)))).forEach(t=>{let a=t.data(),l=(a.multipliers||{})[e]||0;if(l){let e=(a.pixels||0)*l;u.push({id:t.id,name:a.name||"Activity",type:a.type||"activity",pixelsPer:a.pixels||0,multiplier:l,total:e}),m+=e}});let p=a.pixelCached??a.pixels??m+l,f=[];d&&(f=(await (0,h.getDocs)((0,h.query)((0,h.collection)(b.db,"users"),(0,h.orderBy)("pixelCached","desc"),(0,h.limit)(10)))).docs.map(e=>{let t=e.data(),a=`${t.firstName||""} ${t.lastName||""}`.trim()||"Member";return{id:e.id,name:a,pixels:t.pixelCached??t.pixels??0}}));let g=`${a.firstName||""} ${a.lastName||""}`.trim()||"Member",N=f.findIndex(t=>t.id===e);return{userName:g,email:a.email||a.slackEmail||"",pixelTotal:p,pixelDelta:l,pixelLog:x,leaderboard:f,leaderboardEnabled:d,activities:u,rank:N>=0?N+1:void 0}}var f=e.i(66027);function g(){let{user:e}=(0,u.useAuth)(),{data:s,isLoading:d,error:x,refetch:h,isFetching:b}=(0,f.useQuery)({queryKey:["dashboard",e?.uid],queryFn:()=>p(e.uid),enabled:!!e,staleTime:6e4});return(0,t.jsxs)(l.ProtectedRoute,{children:[(0,t.jsx)(a.default,{}),(0,t.jsx)("main",{className:"bg-zinc-50",children:(0,t.jsxs)("div",{className:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-10",children:[d&&(0,t.jsx)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-6 text-sm text-zinc-700 shadow-sm",children:"Loading dashboard…"}),x&&(0,t.jsx)("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-6 text-sm text-rose-800 shadow-sm",children:"Could not load dashboard data."}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o,{name:s.userName,email:s.email,pixelTotal:s.pixelTotal,pixelDelta:s.pixelDelta,rank:s.rank}),(0,t.jsx)(c,{pixelDelta:s.pixelDelta}),(0,t.jsx)(n,{rows:s.pixelLog}),(0,t.jsx)(m,{rows:s.activities}),(0,t.jsx)(r,{rows:s.leaderboard,enabled:s.leaderboardEnabled}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>h(),disabled:b,children:b?"Refreshing…":"Refresh"})})]})]})})]})}e.s(["default",()=>g],52683)}]);