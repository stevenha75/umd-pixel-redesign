(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return i}});let i=e=>{}},84774,e=>{"use strict";var t=e.i(43476),a=e.i(75157);function i({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...i})})}function s({className:e,...i}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...i})}function l({className:e,...i}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...i})}function r({className:e,...i}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...i})}function n({className:e,...i}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...i})}function d({className:e,...i}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...i})}e.s(["Table",()=>i,"TableBody",()=>l,"TableCell",()=>d,"TableHead",()=>n,"TableHeader",()=>s,"TableRow",()=>r])},50630,93479,99682,9165,e=>{"use strict";var t=e.i(43476),a=e.i(22016),i=e.i(45678),s=e.i(18566);let l=[{href:"/admin",label:"Events"},{href:"/admin/members",label:"Members"},{href:"/admin/activities",label:"Activities"},{href:"/admin/settings",label:"Settings"}];function r({children:e}){let r=(0,s.usePathname)();return(0,t.jsxs)("div",{className:"min-h-screen bg-zinc-50",children:[(0,t.jsx)(i.default,{}),(0,t.jsxs)("div",{className:"mx-auto flex max-w-6xl gap-6 px-4 py-8",children:[(0,t.jsxs)("aside",{className:"hidden w-56 flex-shrink-0 rounded-2xl border border-zinc-200 bg-white p-4 shadow-sm md:block",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-zinc-900",children:"Admin"}),(0,t.jsx)("div",{className:"mt-4 flex flex-col gap-2 text-sm",children:l.map(e=>{let i=r===e.href;return(0,t.jsx)(a.default,{href:e.href,className:`rounded-lg px-3 py-2 font-medium ${i?"bg-black text-white":"text-zinc-800 hover:bg-zinc-100"}`,children:e.label},e.href)})})]}),(0,t.jsx)("main",{className:"flex-1",children:e})]})]})}e.s(["AdminLayout",()=>r],50630);var n=e.i(75157);function d({className:e,type:a,...i}){return(0,t.jsx)("input",{type:a,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...i})}e.s(["Input",()=>d],93479);var c=e.i(71645);function o(e){let t=c.useRef({value:e,previous:e});return c.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}e.s(["usePrevious",()=>o],99682),e.i(36180);var u=e.i(98925),m=e.i(59141);async function x(){let e=await (0,u.getDoc)((0,u.doc)(m.db,"settings","global")),t=e.data()?.currentSemesterId||null,a=t?(0,u.query)((0,u.collection)(m.db,"events"),(0,u.where)("semesterId","==",t),(0,u.orderBy)("date","desc")):(0,u.query)((0,u.collection)(m.db,"events"),(0,u.orderBy)("date","desc")),i=await (0,u.getDocs)(a),s=[],l=new Map,r=new Set;i.forEach(e=>{let t=e.data(),a=t.date?.toDate?.()??(t.date instanceof Date?t.date:new Date(t.date||Date.now())),i=t.name||"Event",n=t.attendees||[];n.forEach(e=>r.add(e)),s.push({id:e.id,name:i,date:a.toISOString(),type:t.type||"GBM",pixels:t.pixels||0,attendeesCount:n.length,attendees:[]}),l.set(e.id,i)});let n=await (0,u.getDocs)((0,u.query)((0,u.collectionGroup)(m.db,"excused_absences"),(0,u.orderBy)("createdAt","desc"))),d=[],c=new Set(r);n.forEach(e=>{let t=e.data(),a=e.ref.parent.parent?.id||"";d.push({id:e.id,eventId:a,eventName:l.get(a)||"Event",userId:t.userId||"",userName:"",userEmail:"",reason:t.reason||"",status:t.status||"pending"}),t.userId&&c.add(t.userId)});let o=new Map;return await Promise.all(Array.from(c).map(async e=>{let t=await (0,u.getDoc)((0,u.doc)(m.db,"users",e));if(t.exists()){let a=t.data(),i=`${a.firstName||""} ${a.lastName||""}`.trim()||"Member",s=a.email||a.slackEmail||"";o.set(e,{name:i,email:s})}})),d.forEach(e=>{let t=o.get(e.userId);t&&(e.userName=t.name,e.userEmail=t.email)}),s.forEach(e=>{let t=i.docs.find(t=>t.id===e.id),a=t?.data();e.attendees=(a?.attendees||[]).map(e=>{let t=o.get(e);return{id:e,name:t?.name||e,email:t?.email||""}})}),{events:s,excused:d,currentSemesterId:t}}async function p(e,t){let a=e.date?new Date(e.date):new Date,i=u.Timestamp.fromDate(a),s={name:e.name,semesterId:t||"",date:i,type:e.type,pixels:Number(e.pixels)||0,attendees:[]};return{id:(await (0,u.addDoc)((0,u.collection)(m.db,"events"),s)).id,name:s.name,date:a.toISOString(),type:s.type,pixels:s.pixels,attendeesCount:0}}async function h(e,t){let a=t.date?new Date(t.date):new Date,i=u.Timestamp.fromDate(a);return await (0,u.updateDoc)((0,u.doc)(m.db,"events",e),{name:t.name,type:t.type,pixels:Number(t.pixels)||0,date:i}),{id:e,name:t.name,date:a.toISOString(),type:t.type,pixels:Number(t.pixels)||0}}async function b(e){await (0,u.deleteDoc)((0,u.doc)(m.db,"events",e))}async function f(e,t){await (0,u.updateDoc)((0,u.doc)(m.db,"events",e),{pixels:Number(t)||0})}async function y(e,t,a){await (0,u.updateDoc)((0,u.doc)(m.db,"events",e,"excused_absences",t),{status:a})}async function v(e,t){await (0,u.updateDoc)((0,u.doc)(m.db,"events",e),{attendees:(0,u.arrayUnion)(t)})}async function g(e,t){await (0,u.updateDoc)((0,u.doc)(m.db,"events",e),{attendees:(0,u.arrayRemove)(t)})}async function w(e,t,a){let i=(0,u.doc)(m.db,"events",e);if("present"===a){await (0,u.updateDoc)(i,{attendees:(0,u.arrayUnion)(t)});let e=await (0,u.getDocs)((0,u.query)((0,u.collection)(i,"excused_absences"),(0,u.where)("userId","==",t)));await Promise.all(e.docs.map(e=>(0,u.deleteDoc)(e.ref)))}else if("excused"===a){await (0,u.updateDoc)(i,{attendees:(0,u.arrayRemove)(t)});let e=await (0,u.getDocs)((0,u.query)((0,u.collection)(i,"excused_absences"),(0,u.where)("userId","==",t)));e.empty?await (0,u.addDoc)((0,u.collection)(i,"excused_absences"),{userId:t,status:"approved",reason:"Marked excused by admin",createdAt:u.Timestamp.now()}):await Promise.all(e.docs.map(e=>(0,u.updateDoc)(e.ref,{status:"approved"})))}else{await (0,u.updateDoc)(i,{attendees:(0,u.arrayRemove)(t)});let e=await (0,u.getDocs)((0,u.query)((0,u.collection)(i,"excused_absences"),(0,u.where)("userId","==",t)));await Promise.all(e.docs.map(e=>(0,u.deleteDoc)(e.ref)))}}async function j(){return(await (0,u.getDocs)((0,u.query)((0,u.collection)(m.db,"users"),(0,u.orderBy)("pixelCached","desc")))).docs.map((e,t)=>{let a=e.data();return{id:e.id,firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||a.slackEmail||"",pixels:a.pixelCached??a.pixels??0,pixelDelta:a.pixelDelta??a.pixeldelta??0,rank:t+1}})}async function N(e){return{id:(await (0,u.addDoc)((0,u.collection)(m.db,"users"),{...e,isAdmin:!1,pixelDelta:0,pixelCached:0,createdAt:u.Timestamp.now()})).id,...e,pixels:0,pixelDelta:0}}async function D(e,t){await (0,u.updateDoc)((0,u.doc)(m.db,"users",e),{firstName:t.firstName,lastName:t.lastName,email:t.email})}async function C(e){await (0,u.deleteDoc)((0,u.doc)(m.db,"users",e))}async function T(e,t){await (0,u.updateDoc)((0,u.doc)(m.db,"users",e),{isAdmin:t})}async function S(e,t){let a=Array.from(new Set(t.map(e=>e.trim()).filter(Boolean))),i=[];for(let e of a)(await (0,u.getDocs)((0,u.query)((0,u.collection)(m.db,"users"),(0,u.where)("email","==",e.toLowerCase())))).forEach(e=>i.push(e.id));return i.length&&await (0,u.updateDoc)((0,u.doc)(m.db,"events",e),{attendees:(0,u.arrayUnion)(...i)}),i}async function I(e){let t=(0,u.collection)(m.db,"activities"),a=e?(0,u.query)(t,(0,u.where)("semesterId","==",e),(0,u.orderBy)("name","asc")):(0,u.query)(t,(0,u.orderBy)("name","asc"));return(await (0,u.getDocs)(a)).docs.map(e=>{let t=e.data(),a=Object.entries(t.multipliers||{}).map(([e,t])=>({userId:e,multiplier:Number(t)}));return{id:e.id,name:t.name||"Activity",type:t.type||"other",pixels:t.pixels||0,semesterId:t.semesterId,multipliers:a}})}async function A(e){return{id:(await (0,u.addDoc)((0,u.collection)(m.db,"activities"),{...e,multipliers:{},createdAt:u.Timestamp.now()})).id,...e,multipliers:[]}}async function E(e,t){await (0,u.updateDoc)((0,u.doc)(m.db,"activities",e),{name:t.name,type:t.type,pixels:t.pixels,semesterId:t.semesterId})}async function B(e){await (0,u.deleteDoc)((0,u.doc)(m.db,"activities",e))}async function M(e,t,a){await (0,u.updateDoc)((0,u.doc)(m.db,"activities",e),{[`multipliers.${t}`]:a})}async function k(e){let t=await (0,u.getDocs)((0,u.query)((0,u.collection)(m.db,"users"),(0,u.where)("email","==",e.toLowerCase())));return t.empty?null:t.docs[0].id}async function q(e){let t=Array.from(new Set(e)),a=new Map;return await Promise.all(t.map(async e=>{let t=await (0,u.getDoc)((0,u.doc)(m.db,"users",e));if(t.exists()){let i=t.data(),s=`${i.firstName||""} ${i.lastName||""}`.trim()||"Member",l=i.email||i.slackEmail||"";a.set(e,{name:s,email:l})}})),a}e.s(["addAttendee",()=>v,"addAttendeesByEmail",()=>S,"addMember",()=>N,"createActivity",()=>A,"createEvent",()=>p,"deleteActivity",()=>B,"deleteEventById",()=>b,"deleteMember",()=>C,"fetchActivities",()=>I,"fetchAdminData",()=>x,"fetchMembers",()=>j,"fetchUserDetails",()=>q,"findUserIdByEmail",()=>k,"removeAttendee",()=>g,"setActivityMultiplier",()=>M,"setAdminFlag",()=>T,"setAttendanceStatus",()=>w,"updateActivity",()=>E,"updateEvent",()=>h,"updateEventPixels",()=>f,"updateExcusedStatus",()=>y,"updateMember",()=>D],9165)},58953,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(11870),s=e.i(50630),l=e.i(15288),r=e.i(84774),n=e.i(93479),d=e.i(19455),c=e.i(67489),o=e.i(66027),u=e.i(9165);function m(){let e=(0,o.useQuery)({queryKey:["admin-data"],queryFn:u.fetchAdminData}),m=(0,o.useQuery)({queryKey:["activities"],queryFn:async()=>{let t=e.data?.currentSemesterId||void 0;return(0,u.fetchActivities)(t)},enabled:!!e.data}),[x,p]=(0,a.useState)(new Map),h=async e=>{let t=m.data?.find(t=>t.id===e);if(!t)return;let a=t.multipliers.map(e=>e.userId);p(await (0,u.fetchUserDetails)(a))},[b,f]=(0,a.useState)({name:"",type:"coffee_chat",pixels:0}),[y,v]=(0,a.useState)(null),[g,w]=(0,a.useState)(""),[j,N]=(0,a.useState)(1),[D,C]=(0,a.useState)(null),[T,S]=(0,a.useState)(!1),I=async()=>{S(!0);try{y?await (0,u.updateActivity)(y,b):await (0,u.createActivity)({...b,semesterId:e.data?.currentSemesterId||void 0}),f({name:"",type:"coffee_chat",pixels:0}),v(null),await m.refetch()}finally{S(!1)}},A=async e=>{S(!0);try{await (0,u.deleteActivity)(e),await m.refetch()}finally{S(!1)}},E=async()=>{if(D&&g.trim()){S(!0);try{let e=Number(j)||1,t=g.includes("@")?await (0,u.findUserIdByEmail)(g.trim()):g.trim();if(!t)return void S(!1);await (0,u.setActivityMultiplier)(D,t,e),await m.refetch(),w(""),N(1)}finally{S(!1)}}};return(0,t.jsx)(i.ProtectedRoute,{requireAdmin:!0,children:(0,t.jsx)(s.AdminLayout,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-6 pb-10",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Activities"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Track coffee chats, bonding, and other activities with per-member multipliers."})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsx)(l.CardTitle,{children:y?"Edit activity":"Create activity"}),(0,t.jsx)(l.CardDescription,{children:"Pixels will apply multiplier per member."})]}),(0,t.jsxs)(l.CardContent,{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsx)(n.Input,{placeholder:"Activity name",value:b.name,onChange:e=>f(t=>({...t,name:e.target.value}))}),(0,t.jsxs)(c.Select,{value:b.type,onValueChange:e=>f(t=>({...t,type:e})),children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{placeholder:"Type"})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"coffee_chat",children:"Coffee Chat"}),(0,t.jsx)(c.SelectItem,{value:"bonding",children:"Bonding"}),(0,t.jsx)(c.SelectItem,{value:"other",children:"Other Activity"})]})]}),(0,t.jsx)(n.Input,{type:"number",min:0,value:b.pixels,onChange:e=>f(t=>({...t,pixels:Number(e.target.value)})),placeholder:"Pixels value"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(d.Button,{onClick:I,disabled:T,children:T?"Saving…":y?"Save changes":"Create activity"}),y&&(0,t.jsx)(d.Button,{variant:"outline",onClick:()=>v(null),disabled:T,children:"Cancel"})]})]})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(l.CardTitle,{children:"Activities list"}),(0,t.jsx)(l.CardDescription,{children:m.isLoading?"Loading…":`${m.data?.length||0} activities`})]})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(r.Table,{children:[(0,t.jsx)(r.TableHeader,{children:(0,t.jsxs)(r.TableRow,{children:[(0,t.jsx)(r.TableHead,{children:"Name"}),(0,t.jsx)(r.TableHead,{children:"Type"}),(0,t.jsx)(r.TableHead,{className:"text-right",children:"Pixels"}),(0,t.jsx)(r.TableHead,{className:"text-right",children:"Multipliers"}),(0,t.jsx)(r.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsxs)(r.TableBody,{children:[m.data?.map(e=>(0,t.jsxs)(r.TableRow,{children:[(0,t.jsx)(r.TableCell,{className:"text-foreground",children:e.name}),(0,t.jsx)(r.TableCell,{className:"text-muted-foreground",children:e.type}),(0,t.jsx)(r.TableCell,{className:"text-right text-muted-foreground",children:e.pixels}),(0,t.jsx)(r.TableCell,{className:"text-right text-muted-foreground",children:e.multipliers.length}),(0,t.jsx)(r.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>{v(e.id),f({name:e.name,type:e.type,pixels:e.pixels})},children:"Edit"}),(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>C(e.id),children:"Manage"}),(0,t.jsx)(d.Button,{variant:"destructive",size:"sm",onClick:()=>A(e.id),disabled:T,children:"Delete"})]})})]},e.id)),!m.data?.length&&(0,t.jsx)(r.TableRow,{children:(0,t.jsx)(r.TableCell,{colSpan:5,className:"py-6 text-center text-muted-foreground",children:"No activities yet."})})]})]})})})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsx)(l.CardTitle,{children:"Manage multipliers"}),(0,t.jsx)(l.CardDescription,{children:"Set multiplier per member for an activity."})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-3",children:[(0,t.jsxs)(c.Select,{value:D||"",onValueChange:async e=>{C(e),await h(e)},children:[(0,t.jsx)(c.SelectTrigger,{className:"w-64",children:(0,t.jsx)(c.SelectValue,{placeholder:"Select activity"})}),(0,t.jsx)(c.SelectContent,{children:m.data?.map(e=>(0,t.jsx)(c.SelectItem,{value:e.id,children:e.name},e.id))})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,t.jsx)(n.Input,{placeholder:"User ID",value:g,onChange:e=>w(e.target.value)}),(0,t.jsx)(n.Input,{type:"number",min:1,placeholder:"Multiplier",value:j,onChange:e=>N(Number(e.target.value))}),(0,t.jsx)(d.Button,{onClick:E,disabled:T||!D||!g,children:"Set multiplier"})]}),D&&(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(r.Table,{children:[(0,t.jsx)(r.TableHeader,{children:(0,t.jsxs)(r.TableRow,{children:[(0,t.jsx)(r.TableHead,{children:"User"}),(0,t.jsx)(r.TableHead,{children:"Email"}),(0,t.jsx)(r.TableHead,{className:"text-right",children:"Multiplier"})]})}),(0,t.jsx)(r.TableBody,{children:m.data?.find(e=>e.id===D)?.multipliers.map(e=>{let a=x.get(e.userId);return(0,t.jsxs)(r.TableRow,{children:[(0,t.jsx)(r.TableCell,{className:"text-foreground",children:a?.name||e.userId}),(0,t.jsx)(r.TableCell,{className:"text-muted-foreground",children:a?.email||""}),(0,t.jsx)(r.TableCell,{className:"text-right text-muted-foreground",children:e.multiplier})]},e.userId)})??(0,t.jsx)(r.TableRow,{children:(0,t.jsx)(r.TableCell,{colSpan:3,className:"py-4 text-center text-muted-foreground",children:"No multipliers yet."})})})]})})]})]})]})})})}e.s(["default",()=>m])}]);